### 什么是IDS/IPS ###

<b>摘要</b>
IDS(入侵检测系统)和IPS(入侵防御系统)，这两者均是保护我们网络安全的重要机制。在过去几年里，网络攻击所带来的安全威胁严重程度已经上升了很多倍，几乎每个月都会发生数起严重的数据泄露事件。基于网络的IDS/IPS并不是一种新出现的技术，但是考虑到网络攻击技术的最新发展趋势，IDS和IPS的实现方式仍然是我们需要理解和考虑的内容。

<b>什么是基于网络的IDS和IPS</b>
入侵检测系统(IDS)是一种通过实时监控网络流量来定位和识别恶意流量的软件。在网络系统中IDS所处的位置是一个非常关键的设计因素，IDS一般会在部署防火墙之后，但我们还应该充分了解网络数据和整体网络架构之后再去考虑IDS部署位置。除此之外，为了进一步提升网络和整体安全性，我们建议可以部署多个IDS
```
a. 使用签名：厂商可以提供2000多种签名，IDS可以使用这些签名对网络流量进行模式匹配。当一个新的数据包进入我们的网络之后，它可以根据数据库中的签名数据来分析其相似度，如果检测到了匹配发生，则会发出警报。

b. 搜索异常：即为用户的使用操作设定一条基准线。比如说，如果三十个人同时打开了一个连接（考虑连接数x5），那么如果一个非正常的请求同时建立了30×5=150条连接，则会发出警报。

c. 协议异常：即检测基于协议的异常信息。例如系统所使用的协议为HTTP，但系统检测到了某些请求使用了其他协议或者未知命令时，系统则会认为其违反了常规协议，接下来便会发出警报。
```
当攻击发生时，入侵检测系统只能发出警报，他并不能防止攻击的发生。而入侵防御系统（IPS）却能有效组织攻击行为的发生，因为所有网络流量在达到目标服务器之前，都需要流经IPS。所以在没有得允许的情况下，恶意软件是无法触及服务器的。

企业环境的IDS构造设计图如下：
![](https://s2.ax1x.com/2019/03/29/A0VFHJ.png)

```
a. IDS一般部署在防火墙之后。

b. 在上面的设计图中，Location 1部署的IDS用于保护Web服务器。

c. Location 2部署的IDS用于保护余下的网络组件免受恶意软件的危害。

d. 这是一个基于网络的IDS，而并非基于主机的IDS，因此它无法检测到网络中两台主机之间所生成的恶意软件。
```
<b>IDS/IPS</b>
基于主机的IDS和IPS：
基于主机的IS只能监控一个系统，它运行在你需要保护的系统之中，它能够读取主机的日志并寻找异常。但需要注意的是，当攻击发生之后，基于主机的IDS才能检测到异常。基于网络的IPS能够检测到网段中的数据包，如果基于网络的IPS设计得当的话，它也许能够代替主机的IPS。基于主机的IDS其另一个缺点就是，网络中的每一台主机都需要部署一个基于主机的IDS系统。你可以设想一下，如果你的环境中有5000台主机，这样一来你的部署成本就会非常高了。

基于设备的IDS/IPS：
你可以在一台物理服务器或虚拟服务器中安装IDS，但你需要开启两个接口来处理流入和流出的网络流量。除此之外，你还可以在Ubuntu服务器（虚拟机）上安装类似Snort的IDS软件。

基于防火墙的IDS/IPS：
防火墙与IDS之间的区别在于，防火墙看起来可以防止外部威胁进入我们的网络，但它并不能监控网络内部所发生的攻击行为。很多厂商会在防火墙中整合IPS和IDS，这样就可以给防火墙又添加了一层保护功能。

基于云环境下的IDS/IPS实现：
对于那些将自己的文件和应用托管在云端的用户来说，云服务提供商是否部署了IDS也许会成为客户考虑的其中一个因素。除此之外，用户还可以部署Snort IDS（社区版）来监控和感知威胁。

云环境下的IDS架构如下图所示：
![](https://s2.ax1x.com/2019/03/29/A0VNgf.png)


针对智能物联网设备的IDS/IPS设计
随着越来越多的用户开始使用物联网设备或智能家居设备，因此我们还要考虑如何防止IOT设备遭受外部恶意软件的攻击。由于考虑到设备功能和容量大小会不同，因此我们也许要根据设备的性能来设计自定义的IDS。

智能家居环境下的ISD/IPS部署架构如下图所示：
![](https://s2.ax1x.com/2019/03/29/A0VYCt.png)

使用机器学习算法实现入侵检测
现在有很多机器学习算法能够检测异常并生成警告。机器学习算法可以对恶意行为的模式进行学习，即使恶意行为发生改变，它也能够迅速生成警报。

将机器学习方法应用到IDS/IPS：
![](https://s2.ax1x.com/2019/03/29/A0Vg2V.png)