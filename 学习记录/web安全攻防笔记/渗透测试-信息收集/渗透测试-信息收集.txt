渗透测试之信息收集
收集域名信息
1.whois查询 
kali命令：whois baidu.com
在线查询网：https://www.aizhan.com/
x社区：https://x.threatbook.cn
1.2备案查询信息查询
ICP查询网：http://www.beianbeian.com
天眼查：http://www.tianyancha.com
1.3google搜集敏感信息
google常用语法及说明
关键字：site 说明：指定域名 用法：site baidu.com
关键字：inurl 说明：URL存在关键字的网页 用法：inurl:百度
关键字：intext 说明：网页正文中的关键字 用法：intext:闪电侠
关键字：filetype: 说明：指定文件类型 用法：filetype:PDF
关键字：intitle 说明：网页标题中的关键字 用法：intitle:freebuf
关键字：link 说明：与目标域名做了链接的url 用法：link:baidu.com
关键字：info 说明：查找指定站点的一些基本信息
关键字：cache 说明：搜索google里面关于某些内容的缓存 用法：cache:google
常见组合例子：intext:管理员密码 filetype:xls

1.4收集子域名信息
常用工具：K8,wydomain,Sublist3r,dnsmaper,subDomainsBrute,Maltego,CE
在线收集：http://i.links.cn/subdomain/
搜索引擎枚举：site:baidu.com
证书透明度公安开日志枚举：https://crt.sh和https://censys.io

1.5收集常用端口信息
常用工具：nmap，御剑高速端口扫描器，mascan
常见端口信息及攻击方法说明
*文件共享服务端口
端口号：21/22/69 端口说明：Ftp/Tftp文件传输协议 攻击方向：也许匿名的文件上传，下载，爆破和嗅探操作
端口号：2049 端口说明：Nfs服务 攻击方向：配置不当
端口号：139 端口说明：Samba服务 攻击方向：爆破，未授权访问，远程代码执行
端口号：389 端口说明：Ldap目录访问协议 攻击方向：注入，允许匿名访问，弱口令
*远程连接服务端口
端口号：22 端口说明：SSH远程连接 攻击方向：爆破，ssh隧道及代理转发，文件传输 若是libssh可尝试绕过ssh登录
端口号：23 端口说明：Telnet远程连接 攻击方向：爆破，嗅探，弱口令
端口号：3389 端口说明：RDP远程桌面连接 攻击方向：Shift后门（需要windows server 2003以下的系统），爆破
端口号：5900 端口说明：VNC 攻击方向：弱口令爆破
端口号：5632 端口说明：PyAnywhere服务 攻击方向：抓密码，代码执行
*web应用服务端口
端口号：80/443/8080 端口说明：常见的web服务端口 攻击方向：Web攻击，爆破，对应服务版本漏洞
端口号：7001/7002 端口说明：WebLogic控制台 攻击方向：Java反序列化，弱口令
端口号：8080/8089 端口说明：Jboss/Resin/Jetty/Jenkins 攻击方向：反序列化，控制台弱口令
端口号：9090 端口说明：WebSphere控制台 攻击方向：Java反序列化，弱口令
端口号：4848 端口说明：GlassFish控制台 攻击方向：弱口令
端口号：1352 端口说明：Lotus domain邮件服务 攻击方向：弱口令，信息泄露，爆破
端口号：10000 端口说明：Webmin-Web控制面板 攻击方向：弱口令
*数据库服务端口
端口号：3306 端口说明：MySQL  攻击方向：注入，提权，爆破
端口号：1433 端口说明：MSSQL 攻击方向：注入，提权，SA弱口令，爆破
端口号：1521 端口说明：Oracle 攻击方向：TNS爆破，注入，反弹shell
端口号：5432 端口说明：PostgerSQL 攻击方向：爆破，注入，反弹shell
端口号：27017/27018 端口说明：MongoDB 攻击方向：爆破，未授权访问
端口号：6379 端口说明：Redis 攻击方向：可尝试未授权访问，弱口令爆破
端口号：5000 端口说明：SysBase/DB2 攻击方向：爆破注入
*邮件服务端口
端口号：25 端口说明：SMTP邮件服务 攻击方向：邮件伪造
端口号：110 端口说明：POP3协议 攻击方向：爆破，嗅探
端口号：143 端口说明：IMAP协议 攻击方向：爆破
*网络常见协议端口
端口号：53 端口说明：DNS域名系统 攻击方向：允许区域传输，DNS劫持，缓存投毒，欺骗
端口号：67/68 端口说明：DHCP 攻击方向：劫持，欺骗
端口号：161 端口说明：SNMP协议 攻击方向：爆破，搜集目标内网信息
*特殊服务端口
端口号：2181 端口说明：Zookeeper服务 攻击方向：未授权访问
端口号：8069 端口说明：Zabix服务 攻击方向：远程执行，SQL注入
端口号：9200/9300 端口说明：Elasticsearh服务 攻击方向：远程执行
端口号：11211 端口说明：Memcache服务 攻击方向：未授权访问
端口号：512/513/514 端口说明：Linux Rexec服务 攻击方向：爆破，Rlogin登录
端口号：873 端口说明：Rsync服务 攻击方向：匿名访问，文件上传
端口号：3690 端口说明：Svn服务 攻击方向：Svn泄露，未授权访问
端口号：5000 端口说明：SAP Mangement Console 攻击方向：远程执行

1.6指纹识别
常用攻击：whatweb
在线收集：云悉，whatweb，BugScanner

1.7查找真实IP
问题：目标服务器存在CDN，如何查找真实IP？ 注释：CDN为网络分发，在不同的地域访问网站可能会造成延迟网络数据低下，使用CDN后server端会把响应发给运营商的节点，在返回给用户，以便大大提高速度和效率

判断目标是否使用了CDN
可以利用在线网站17CE（https://www.17ce.com）进行全国地区的ping服务器操作，然后对比每个地区ping出的IP结果，查看这些IP是否一致，如果都是一样的就不存在CDN，如果IP大多数不一样或规律性极强，就是存在CDN

绕过CDN寻找真实IP
*内部邮箱源，一般的邮件系统都在内部，没有经过CDN的解析，通过目标网站用户注册或RSS的订阅功能，查看邮件，寻找邮件头部的邮件服务器域名IP，ping这个邮件服务器域名，就可以获取目标的真实IP（注意：必须是目标服务器的邮件服务器，第三方邮件公共服务器是没有用的）

*扫描网站测试文件，如phpinfo，test等，从而获取到目标的真实IP
*分站域名。很多主站的访问量会比较大，所以主站都是挂CDN的，分站可能没有挂CDN，可以通过ping二级域名获取分站IP,可能会出现分站和主站不是同一个IP但在同一个C段下面，从而判断出目标的真实IP

*国外访问。国内的CDN往往只对国内用户的访问加速，从而国外的CDN就不一定。因此通过国外在线代理网站App Synthetic Monitor（https://asm.ca.com/en/ping.php）访问可能会得到真实IP

*查询域名的解析记录。也许目标很久以前并没有使用CDN，所以可以通过网站NETCRAFT（https://www.netcraft.com）来观察域名的IP历史记录，也可以大致分析出目标的真实IP段

*绕过CloudFlare CDN查找真实IP。现在很多网站都使用CloudFlare提供的CDN服务，在确定目标网站使用了CDN后，可以先尝试通过在线目标网站CloudFlareWatch（http://www.crimeflare.us/cfs.html）对CloudFlare进行真实IP查询

验证真实IP
找到目标的真实IP以后，如何验证其真实性呢？如果是web，最简单的验证方法就是直接用IP访问，看看响应的页面是不是和访问域名返回的一样：或者在目标比较大的情况下，借助类似于Masscan的工具批量扫描对应IP中所有开了80,443,8080端口的IP，然后逐个尝试IP访问，观察响应结果是否为目标站点

1.8收集敏感目录文件
针对网站目录扫描的工具用：dirbuster，dirb，御剑扫描，wwwscan，Spinder.py,Sensitivefilescan

1.9社会工程学
*假设攻击者对一家公司进行渗透测试，正在收集目标的真实IP阶段，此时就可以利用收集到这家公司的某位销售人员的电子邮箱。首先，给这位销售人发送邮件，假装对某个产品很感兴趣，显然销售人员会回复邮件，这样攻击者就可以通过分析邮件报文获取真实IP

*通过进一步社会工程学，假设现在已经收集了目标人物的邮箱，QQ，电话号码，姓名，以及域名的服务商，也通过爆破或者撞库方法获取邮箱的密码，这时就可以冒充目标人物要求客服人员协助重置域管理密码，甚至技术人员会帮助重置密码，从而使攻击者拿下域管理控制台，然后做域劫持

*除此之外还可以利用社工库查询想要得到的信息，利用收集到的邮箱，可以在社工库里找到泄露的密码，其实还可以通过搜索引擎搜索到社交账号的信息，然后利用社交和社会工程学得到信息构造密码字典，对目标用户邮箱和OA账户进行爆破或撞库